"""generate_module4.py — 模組 4：資料整理應用  (19 slides)

Usage:
    cd slides && uv run python generate_module4.py
"""
from shared import (
    new_prs, blank, set_bg, txbox, rect, header_bar, save_pptx,
    cover_slide, objectives_slide, content_slide, table_slide,
    two_col_slide, cta_slide, alert_slide, code_slide,
    card_grid_slide,
    PRIMARY, SECONDARY, LIGHT_BG, DARK_BG, WHITE, MUTED,
    SUCCESS, WARNING, DANGER, ACCENT, CODE_BG, CODE_FG,
    Inches, PP_ALIGN,
)


def build() -> None:
    prs = new_prs()

    # ── 1. Cover ─────────────────────────────────────────────────────────────
    cover_slide(
        prs, "4", "資料整理應用",
        "Excel 公式・資料摘要・圖表說明 — 數據處理好幫手",
        "1 分鐘（導言）",
    )

    # ── 2. 開場鉤子 ───────────────────────────────────────────────────────────
    sl = blank(prs)
    set_bg(sl, DARK_BG)
    rect(sl, Inches(0), Inches(0), Inches(0.22), Inches(7.5), SUCCESS)

    txbox(sl,
          "統計表格、圖表說明、長篇報告摘要——\n"
          "這三件事，您可能一週就要做好幾次，\n"
          "每次都花上半小時甚至更長。",
          Inches(0.55), Inches(0.8), Inches(11.5), Inches(2.5),
          size=28, bold=True, color=WHITE)

    # Time graphic
    rect(sl, Inches(0.55), Inches(3.6), Inches(5.5), Inches(0.8), DANGER)
    txbox(sl, "⏱  以前：30 分鐘以上",
          Inches(0.55), Inches(3.6), Inches(5.5), Inches(0.8),
          size=20, bold=True, color=WHITE, align=PP_ALIGN.CENTER)
    rect(sl, Inches(7.2), Inches(3.6), Inches(5.5), Inches(0.8), SUCCESS)
    txbox(sl, "⚡  學完後：5 分鐘以內",
          Inches(7.2), Inches(3.6), Inches(5.5), Inches(0.8),
          size=20, bold=True, color=WHITE, align=PP_ALIGN.CENTER)

    txbox(sl,
          "這個模組要把這個時間縮短到 5 分鐘以內。",
          Inches(0.55), Inches(5.0), Inches(11.5), Inches(0.7),
          size=22, color=SECONDARY)

    # ── 3. 學習目標 ───────────────────────────────────────────────────────────
    objectives_slide(prs, [
        "告訴 AI 表格結構，讓它直接生成您需要的 Excel 公式",
        "把一份 10 頁報告，在 30 秒內摘要成 5 個重點",
        "用 AI 把數字圖表寫成清楚的文字說明，讓長官一目了然",
    ])

    # ── 4. Excel 公式生成說明 ─────────────────────────────────────────────────
    content_slide(prs, "Excel 公式 Prompt 的關鍵", [
        "說明資料結構：欄位位置（如 A 欄是日期、B 欄是數量）",
        "描述計算邏輯：用白話說明想要的結果",
        "指定條件：如果有篩選條件要說清楚",
        "提供範例資料：幫助 AI 理解您的表格",
        "  ⚠  AI 生成的公式請先在少量資料上測試，確認正確後再大量使用",
    ])

    # ── 5. Excel Prompt 範例 ──────────────────────────────────────────────────
    code_slide(prs, "Excel Prompt 範例：疫苗覆蓋率計算",
        "我需要一個 Excel 公式。\n\n"
        "【資料說明】\n"
        "  - A 欄：縣市名稱\n"
        "  - B 欄：65 歲以上人口數\n"
        "  - C 欄：已接種人數\n\n"
        "【需求】\n"
        "  請幫我寫一個公式，放在 D 欄，\n"
        "  計算每個縣市的疫苗覆蓋率（已接種人數 / 65歲以上人口數），\n"
        "  以百分比顯示，保留一位小數。\n\n"
        "【範例】A2: 台北市, B2: 500000, C2: 350000\n"
        "預期 D2 結果：70.0%",
        caption="描述越清楚，AI 生成的公式越準確"
    )

    # ── 6. 常見 Excel 函數需求表 ─────────────────────────────────────────────
    table_slide(prs, "常見 Excel 公式需求",
        ["需求類型", "範例描述", "常用函數"],
        [
            ["條件加總", "加總某縣市的所有病例數",       "SUMIF, SUMIFS"],
            ["條件計數", "計算符合條件的紀錄筆數",        "COUNTIF, COUNTIFS"],
            ["查表",    "根據代碼查出對應名稱",           "VLOOKUP, XLOOKUP"],
            ["日期計算", "計算兩日期間隔天數",            "DATEDIF, DATE"],
            ["文字處理", "合併或擷取文字",               "CONCAT, LEFT, RIGHT"],
        ],
        col_widths=[Inches(2.2), Inches(5.5), Inches(4.4)],
    )

    # ── 7. Excel Prompt 好 vs 差對比 ─────────────────────────────────────────
    two_col_slide(prs, "Excel Prompt：好 vs 差",
        "✗  模糊，AI 無從下手", [
            "「幫我寫一個 Excel 公式算總數」",
            "→ 不知道要算什麼、資料在哪裡",
        ],
        "✓  清楚，AI 直接產出公式", [
            "「A 欄是縣市、B 欄是病例數（B2:B23）。\n"
            " 在 B24 計算所有縣市的病例總數。\n"
            " 請提供公式。」",
            "→ AI 能正確產出 =SUM(B2:B23)",
        ],
    )

    # ── 8. 資料摘要應用場景 ───────────────────────────────────────────────────
    content_slide(prs, "資料摘要的常見應用", [
        "疫情監測週報摘要（供署長室主管快速掌握）",
        "研究期刊重點提取",
        "長篇報告精華整理",
        "新聞資訊彙整",
        "摘要品質的關鍵：指定讀者 + 明確結構 + 字數限制 + 格式要求",
    ])

    # ── 9. 疫情週報摘要 Prompt ────────────────────────────────────────────────
    code_slide(prs, "Prompt 範例：疫情週報摘要",
        "請閱讀以下疫情監測週報，並產出摘要。\n\n"
        "【摘要需求】\n"
        "1. 本週重點（50 字以內）\n"
        "2. 各類傳染病監測數據變化（條列式）\n"
        "3. 需特別關注的疫情趨勢\n"
        "4. 建議防疫作為\n\n"
        "【目標讀者】署長室主管\n\n"
        "【週報內容】\n（在此貼上週報內容，請確保已移除敏感個資）",
        caption="⚠  先確認週報無敏感個資，再貼入 AI"
    )

    # ── 10. 期刊文獻提取 Prompt ──────────────────────────────────────────────
    code_slide(prs, "Prompt 範例：期刊文獻重點提取",
        "請分析以下研究文獻，提取關鍵資訊。\n\n"
        "【提取項目】\n"
        "1. 研究目的\n"
        "2. 研究方法（簡述）\n"
        "3. 主要發現（條列 3-5 點）\n"
        "4. 結論與建議\n"
        "5. 對我國防疫的啟示\n\n"
        "【輸出格式】使用條列式，每點不超過 50 字\n\n"
        "【文獻內容】\n（貼上文獻摘要或全文）",
    )

    # ── 11. 摘要品質 4 關鍵卡 ────────────────────────────────────────────────
    card_grid_slide(prs, "摘要品質的四個關鍵",
        [
            (SUCCESS,  "指定讀者",
             "不同讀者需要不同深度\n署長 vs 承辦人 vs 民眾"),
            (PRIMARY,  "明確結構",
             "指定要提取哪些項目\n不讓 AI 自由發揮"),
            (ACCENT,   "字數限制",
             "控制摘要長度\n如「每點不超過 50 字」"),
            (SECONDARY,"格式要求",
             "條列式或段落式？\n要有標題嗎？"),
        ])

    # ── 12. 圖表說明生成說明 ─────────────────────────────────────────────────
    content_slide(prs, "圖表說明文字生成", [
        "AI 根據您提供的數據，生成專業的圖表說明文字",
        "圖表說明的要素：",
        "  整體趨勢：上升、下降、持平",
        "  關鍵數據點：最高、最低、轉折點",
        "  時間比較：與去年同期、與上週比較",
        "  意義解讀：這個趨勢代表什麼",
        "  ⚠  必須提供具體數據，AI 無法憑空創造有意義的說明",
    ])

    # ── 13. 圖表說明 Prompt 範例 ─────────────────────────────────────────────
    code_slide(prs, "Prompt 範例：登革熱病例趨勢圖說明",
        "請為以下統計圖表撰寫說明文字。\n\n"
        "【圖表資訊】\n"
        "  - 主題：2024 年登革熱本土病例週趨勢圖\n"
        "  - 類型：折線圖｜X 軸：週別（第 1-40 週）｜Y 軸：病例數\n\n"
        "【數據摘要】\n"
        "  - 第 1-20 週：每週 0-5 例，累計 50 例\n"
        "  - 第 21 週起：病例開始上升\n"
        "  - 第 30 週：達到高峰，單週 150 例\n"
        "  - 第 31-40 週：緩慢下降，目前每週約 80 例\n\n"
        "【說明需求】趨勢描述 + 關鍵轉折點 + 與去年同期比較（去年 800 例）\n"
        "字數：100-150 字",
    )

    # ── 14. 不同圖表類型說明重點 ─────────────────────────────────────────────
    table_slide(prs, "不同圖表類型的說明重點",
        ["圖表類型", "說明重點"],
        [
            ["折線圖",     "趨勢變化、轉折點、時間比較"],
            ["長條圖",     "各項目比較、最高/最低、差異幅度"],
            ["圓餅圖",     "佔比分布、最大/最小項目"],
            ["地圖（熱區圖）", "地理分布、熱區位置、區域比較"],
        ],
        col_widths=[Inches(3.0), Inches(9.1)],
    )

    # ── 15-18. 四份資料食譜 ──────────────────────────────────────────────────
    code_slide(prs, "食譜 1：Excel 公式生成",
        "我需要一個 Excel 公式。\n\n"
        "【資料結構】\n"
        "  - A 欄：[說明欄位內容]\n"
        "  - B 欄：[說明欄位內容]\n"
        "  - 資料範圍：[如 A2:B100]\n\n"
        "【計算需求】\n"
        "[用白話描述想要的計算]\n\n"
        "【範例】\n"
        "輸入：[範例資料]\n"
        "預期輸出：[預期結果]",
        caption="▶  複製 → 填入 [] 內容 → 貼入 AI → 測試公式"
    )

    code_slide(prs, "食譜 2：疫情週報摘要",
        "請摘要以下疫情監測週報。\n\n"
        "【摘要需求】\n"
        "1. 本週重點（50 字內）\n"
        "2. 各類傳染病數據變化\n"
        "3. 需關注的趨勢\n"
        "4. 建議防疫作為\n\n"
        "【讀者】[署長室 / 各組主管]\n\n"
        "【週報內容】\n[貼上週報，確保無敏感個資]",
        caption="▶  複製 → 填入 [] 內容 → 貼入 AI → 審核"
    )

    code_slide(prs, "食譜 3：圖表說明生成",
        "請為以下圖表撰寫說明。\n\n"
        "【圖表資訊】\n"
        "  - 主題：[圖表標題]\n"
        "  - 類型：[折線圖 / 長條圖 / 圓餅圖]\n"
        "  - X 軸：[說明]\n"
        "  - Y 軸：[說明]\n\n"
        "【數據摘要】\n"
        "[列出關鍵數據點]\n\n"
        "【說明需求】描述趨勢 + 指出關鍵點 + 字數 100-150 字",
        caption="▶  複製 → 填入 [] 內容 → 貼入 AI → 審核"
    )

    code_slide(prs, "食譜 4：文獻重點提取",
        "請分析以下文獻，提取重點。\n\n"
        "【提取項目】\n"
        "1. 研究目的\n"
        "2. 研究方法\n"
        "3. 主要發現（3-5 點）\n"
        "4. 結論與建議\n"
        "5. 對我國的啟示\n\n"
        "【格式】條列式，每點 50 字內\n\n"
        "【文獻】\n[貼上文獻內容]",
        caption="▶  複製 → 填入文獻 → 貼入 AI → 審核"
    )

    # ── 19. CTA ──────────────────────────────────────────────────────────────
    cta_slide(prs,
              "資安提醒：處理資料前，\n確認沒有個人識別資訊或機密數據！\n\n完成測驗後，前往最後一個模組。",
              "▶  前往模組 5：進階技巧")

    save_pptx(prs, "module4_資料整理應用.pptx")


if __name__ == "__main__":
    build()
