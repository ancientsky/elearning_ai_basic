"""generate_module3.py — 模組 3：文書處理應用  (18 slides)

Usage:
    cd slides && uv run python generate_module3.py
"""
from shared import (
    new_prs, blank, set_bg, txbox, rect, header_bar, save_pptx,
    cover_slide, objectives_slide, content_slide, table_slide,
    two_col_slide, cta_slide, alert_slide, code_slide,
    card_grid_slide,
    PRIMARY, SECONDARY, LIGHT_BG, DARK_BG, WHITE, MUTED,
    SUCCESS, WARNING, DANGER, ACCENT, CODE_BG, CODE_FG,
    Inches, PP_ALIGN,
)


def build() -> None:
    prs = new_prs()

    # ── 1. Cover ─────────────────────────────────────────────────────────────
    cover_slide(
        prs, "3", "文書處理應用",
        "公文撰寫・會議紀錄・Email — 提升日常文書效率",
        "1 分鐘（導言）",
    )

    # ── 2. 開場鉤子 ───────────────────────────────────────────────────────────
    sl = blank(prs)
    set_bg(sl, DARK_BG)
    rect(sl, Inches(0), Inches(0), Inches(0.22), Inches(7.5), WARNING)

    txbox(sl,
          "一份公文——\n格式、用語、行文規範……\n光確認這些細節，有時比實際寫作還費時。",
          Inches(0.55), Inches(1.0), Inches(11.5), Inches(2.5),
          size=30, bold=True, color=WHITE)

    txbox(sl,
          "如果 AI 能幫您先處理掉這個部分呢？\n\n"
          "5 分鐘後，您就有第一份 AI 協助的公文草稿。",
          Inches(0.55), Inches(3.8), Inches(11.5), Inches(1.8),
          size=22, color=SECONDARY)

    # ── 3. 學習目標 ───────────────────────────────────────────────────────────
    objectives_slide(prs, [
        "用 AI 起草正式公文，包含固定格式和標準用語",
        "把會議筆記或速記整理成結構化的會議紀錄",
        "撰寫對外或對內的專業 Email（回覆民眾、催辦、通知）",
    ])

    # ── 4. 公文 Prompt 關鍵要素 ──────────────────────────────────────────────
    content_slide(prs, "公文 Prompt 的關鍵要素", [
        "角色：政府公文撰寫專家",
        "發文對象：明確說明發文給誰（如各縣市衛生局）",
        "事由／主旨：這份公文要處理什麼事",
        "格式：主旨、說明（條列）、辦法",
        "語氣：正式公文用語",
        "  ⚠  AI 產出是「初稿」，必須審核確認格式後才能使用",
    ])

    # ── 5. 公文 Prompt 範例 ──────────────────────────────────────────────────
    code_slide(prs, "公文 Prompt 範例：疫情通報函",
        "你是政府公文撰寫專家。請根據以下資訊撰寫一份正式公文。\n\n"
        "【發文對象】各縣市衛生局\n"
        "【事由】加強登革熱防治措施\n"
        "【背景說明】\n"
        "  近期南部地區登革熱疫情升溫，需請各縣市加強孳生源清除及衛教宣導\n\n"
        "【格式要求】\n"
        "  - 包含：主旨、說明、辦法\n"
        "  - 使用正式公文語氣\n"
        "  - 說明段落以條列方式呈現\n"
        "  - 辦法需明確列出請各單位配合事項",
        caption="複製此 Prompt → 貼入 AI → 審核 → 完成！"
    )

    # ── 6. 公文好 vs 差對比 ──────────────────────────────────────────────────
    two_col_slide(prs, "公文 Prompt：好 vs 差",
        "✗  模糊，AI 不知道要什麼", [
            "「幫我寫一份公文給衛生局」",
            "→ 不知道主題、格式、語氣",
        ],
        "✓  完整，AI 產出直接可用", [
            "「你是公文專家，發給各縣市衛生局，\n主旨：加強流感疫苗接種作業，\n格式：主旨+說明+辦法，正式語氣」",
            "→ AI 能產出格式正確的公文初稿",
        ],
    )

    # ── 7. 會議紀錄關鍵要素 ──────────────────────────────────────────────────
    content_slide(prs, "會議紀錄 Prompt 的關鍵要素", [
        "明確的輸出格式：會議資訊、討論重點、決議、待辦",
        "標註重點：權責單位、負責人、期限",
        "提供原始內容：會議逐字稿或速記筆記",
        "  ⚠  先確認筆記中沒有敏感個資",
        "  ⚠  審核 AI 產出是否正確，補充遺漏細節",
    ])

    # ── 8. 會議紀錄 Prompt 範例 ──────────────────────────────────────────────
    code_slide(prs, "會議紀錄 Prompt 範例",
        "請將以下防疫會議內容整理成結構化的會議紀錄。\n\n"
        "【輸出格式】\n"
        "1. 會議資訊（時間、地點、主持人、出席單位）\n"
        "2. 疫情現況說明摘要\n"
        "3. 討論議題與各單位意見\n"
        "4. 決議事項（含權責單位）\n"
        "5. 待辦事項（含負責人、期限）\n"
        "6. 下次會議時間\n\n"
        "【注意】決議與待辦需標註負責單位，條列式，重點粗體\n\n"
        "【會議內容】\n（在此貼上會議逐字稿或筆記）",
        caption="⚠  確保筆記不含個資後才貼入 AI"
    )

    # ── 9. Email 撰寫關鍵要素 ─────────────────────────────────────────────────
    content_slide(prs, "Email Prompt 的關鍵要素", [
        "收件對象：內部同仁？外部單位？民眾？",
        "目的：通知、邀請、回覆、催辦？",
        "語氣：正式、禮貌、簡潔",
        "重點內容：需要傳達的關鍵資訊",
        "結構：問候 → 主旨說明 → 行動事項 → 結語",
    ])

    # ── 10. Email Prompt 範例（回覆民眾） ────────────────────────────────────
    code_slide(prs, "Email Prompt 範例：回覆民眾詢問",
        "請撰寫一封回覆民眾的 Email。\n\n"
        "【情境】\n"
        "民眾來信詢問流感疫苗接種相關問題，包含：\n"
        "  - 哪裡可以接種？\n"
        "  - 需要付費嗎？\n"
        "  - 接種後有什麼注意事項？\n\n"
        "【Email 要求】\n"
        "  - 語氣：禮貌、親切、專業\n"
        "  - 結構：問候、逐點回覆、結語、署名\n"
        "  - 提供官方查詢管道（疾管署網站、1922）\n"
        "  - 長度適中，不要過長",
    )

    # ── 11. Email Prompt 範例（催辦） ────────────────────────────────────────
    code_slide(prs, "Email Prompt 範例：催辦各單位填報",
        "請撰寫一封催辦 Email。\n\n"
        "【情境】\n"
        "需要催辦各縣市衛生局填報本月疫情監測資料，截止日期為本週五\n\n"
        "【Email 要求】\n"
        "  - 收件對象：各縣市衛生局承辦人\n"
        "  - 語氣：正式但不失禮貌\n"
        "  - 內容：填報事項、系統連結、截止時間、聯絡窗口\n"
        "  - 簡潔有力，重點明確",
    )

    # ── 12. 常見 Email 類型 ──────────────────────────────────────────────────
    card_grid_slide(prs, "常見 Email 類型",
        [
            (PRIMARY,  "會議通知",
             "時間、地點、議程、出席人員\n→ 語氣正式，條列議程"),
            (ACCENT,   "催辦提醒",
             "事項、期限、聯絡方式\n→ 正式但友善，重點突出"),
            (SUCCESS,  "回覆詢問",
             "問題、答覆、後續說明\n→ 禮貌親切，逐點回覆"),
            (SECONDARY,"資料轉發",
             "說明、附件、注意事項\n→ 簡潔說明目的與注意點"),
        ])

    # ── 13. Prompt 食譜介紹 ──────────────────────────────────────────────────
    sl = blank(prs)
    set_bg(sl, LIGHT_BG)
    header_bar(sl, "文書類 Prompt 食譜庫")

    txbox(sl,
          "本模組提供四份可直接複製使用的 Prompt 食譜：",
          Inches(0.6), Inches(1.35), Inches(12.0), Inches(0.6),
          size=20, bold=True, color=PRIMARY)

    recipes = [
        (PRIMARY,   "食譜 1", "疫情通報公文",
         "角色：公文專家\n發文對象 + 事由 + 背景 + 格式"),
        (ACCENT,    "食譜 2", "衛教文宣撰寫",
         "角色：衛教專家\n主題 + 對象 + 重點 + 字數限制"),
        (SUCCESS,   "食譜 3", "會議紀錄整理",
         "結構：資訊、討論、決議、待辦\n貼上逐字稿即可"),
        (SECONDARY, "食譜 4", "回覆民眾詢問",
         "語氣：禮貌親切專業\n逐點回覆 + 官方查詢管道"),
    ]
    for i, (clr, label, title, desc) in enumerate(recipes):
        col = i % 2
        row = i // 2
        left = Inches(0.5) + col * Inches(6.4)
        top  = Inches(2.1) + row * Inches(2.4)
        rect(sl, left, top, Inches(6.0), Inches(2.1), clr)
        txbox(sl, label,
              left + Inches(0.2), top + Inches(0.15),
              Inches(1.5), Inches(0.5),
              size=14, bold=True, color=WHITE)
        txbox(sl, title,
              left + Inches(1.7), top + Inches(0.15),
              Inches(4.1), Inches(0.5),
              size=18, bold=True, color=WHITE)
        txbox(sl, desc,
              left + Inches(0.2), top + Inches(0.75),
              Inches(5.6), Inches(1.2),
              size=15, color=WHITE)

    # ── 14-17. 四份食譜各一張 code slide ─────────────────────────────────────
    code_slide(prs, "食譜 1：疫情通報公文",
        "你是政府公文撰寫專家。請根據以下資訊撰寫正式公文。\n\n"
        "【發文對象】[填入：如各縣市衛生局]\n"
        "【事由】[填入：如加強登革熱防治措施]\n"
        "【背景】[填入相關背景說明]\n\n"
        "【格式要求】\n"
        "  - 包含：主旨、說明、辦法\n"
        "  - 使用正式公文語氣\n"
        "  - 說明以條列方式呈現",
        caption="▶  複製 → 填入 [] 內容 → 貼入 AI → 審核"
    )

    code_slide(prs, "食譜 2：衛教文宣撰寫",
        "你是疾管署衛教專家。請撰寫衛教文宣。\n\n"
        "【主題】[填入：如流感疫苗接種須知]\n"
        "【對象】[一般民眾 / 醫護人員 / 長者]\n"
        "【重點】[填入 2-3 個宣導重點]\n\n"
        "【格式】\n"
        "  - 分段：什麼是XX、為什麼重要、如何預防\n"
        "  - 字數：[填入] 字以內\n"
        "  - 語氣：親切專業，避免術語",
        caption="▶  複製 → 填入 [] 內容 → 貼入 AI → 審核"
    )

    code_slide(prs, "食譜 3：會議紀錄整理",
        "請將以下會議內容整理成結構化紀錄。\n\n"
        "【輸出格式】\n"
        "1. 會議資訊（時間、地點、主持人）\n"
        "2. 出席單位／人員\n"
        "3. 討論議題摘要\n"
        "4. 決議事項（含權責單位）\n"
        "5. 待辦追蹤（負責人、期限）\n\n"
        "【會議內容】\n[貼上逐字稿或筆記]",
        caption="▶  確認無個資 → 複製 Prompt → 貼上逐字稿 → AI 整理"
    )

    code_slide(prs, "食譜 4：回覆民眾詢問",
        "請撰寫回覆民眾詢問的 Email。\n\n"
        "【民眾問題】\n[列出民眾詢問的問題]\n\n"
        "【回覆要求】\n"
        "  - 語氣：禮貌、親切、專業\n"
        "  - 結構：問候、逐點回覆、結語\n"
        "  - 提供官方查詢管道（疾管署網站、1922）\n"
        "  - 長度適中",
        caption="▶  複製 → 填入民眾問題 → 貼入 AI → 審核 → 發送"
    )

    # ── 18. CTA ──────────────────────────────────────────────────────────────
    cta_slide(prs,
              "完成測驗後，\n前往模組 4 學習資料整理技巧！",
              "▶  前往模組 4：資料整理應用")

    save_pptx(prs, "module3_文書處理應用.pptx")


if __name__ == "__main__":
    build()
