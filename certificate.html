<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµæ¥­è­‰æ›¸ | ç–¾ç®¡ç½² AI æ‡‰ç”¨åŸºç¤ç­</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="page-wrapper">
        <!-- Header -->
        <header>
            <div class="container header-content">
                <div class="logo">
                    <div class="logo-icon">AI</div>
                    <div>
                        <h1>AI æ‡‰ç”¨åŸºç¤ç­</h1>
                        <span class="logo-subtitle">ç–¾ç—…ç®¡åˆ¶ç½² ç¬¬ä¸€å¹´åŸºç¤ç­</span>
                    </div>
                </div>
                <button class="mobile-menu-btn">â˜°</button>
                <nav>
                    <ul>
                        <li><a href="index.html">é¦–é </a></li>
                        <li><a href="recipes/prompt-recipes.html">Prompt é£Ÿè­œ</a></li>
                        <li><a href="resources/links.html">å­¸ç¿’è³‡æº</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <main>
            <div class="container">
                <div class="content-section" style="margin-bottom: 30px;">
                    <h2 style="font-size: 1.8rem; margin-bottom: 8px;">çµæ¥­è­‰æ›¸</h2>
                    <p style="color: var(--text-muted);">å®Œæˆæ‰€æœ‰æ¨¡çµ„ä¸”çµæ¥­æ¸¬é©—æˆç¸¾é” 80% ä»¥ä¸Šï¼Œå³å¯å–å¾—çµæ¥­è­‰æ›¸ã€‚</p>
                </div>

                <!-- Not Eligible Section -->
                <div id="cert-not-eligible" class="content-section" style="display: none;">
                    <h3>è³‡æ ¼éœ€æ±‚</h3>
                    <p>æ‚¨å°šæœªæ»¿è¶³é ˜å–è­‰æ›¸çš„æ¢ä»¶ï¼Œè«‹å®Œæˆä»¥ä¸‹æ‰€æœ‰éœ€æ±‚ï¼š</p>
                    <ul class="cert-checklist" id="cert-requirements-list"></ul>
                    <div style="text-align: center; margin-top: 24px;">
                        <a href="index.html" class="btn btn-primary">è¿”å›é¦–é ç¹¼çºŒå­¸ç¿’</a>
                    </div>
                </div>

                <!-- Eligible Section -->
                <div id="cert-eligible" class="content-section" style="display: none;">
                    <div class="alert alert-success" id="cert-score-display"></div>
                    <h3 style="margin-top: 20px;">è¼¸å…¥æ‚¨çš„å§“å</h3>
                    <p>å§“åå°‡é¡¯ç¤ºåœ¨è­‰æ›¸ä¸Šï¼Œè«‹ç¢ºèªæ­£ç¢ºã€‚</p>
                    <div style="display: flex; gap: 12px; align-items: flex-start; flex-wrap: wrap;">
                        <div>
                            <input type="text" id="cert-name-input" class="cert-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                            <p class="cert-error-text" id="cert-name-error">è«‹è¼¸å…¥å§“å</p>
                        </div>
                        <button class="btn btn-primary btn-lg" onclick="generateCertificate()">ç”¢ç”Ÿè­‰æ›¸</button>
                    </div>
                </div>

                <!-- Preview Section -->
                <div id="cert-preview-section" class="content-section" style="display: none;">
                    <h3>è­‰æ›¸é è¦½</h3>
                    <div class="cert-preview-wrapper">
                        <canvas id="cert-canvas" width="1200" height="850"></canvas>
                    </div>
                    <div class="cert-actions">
                        <button class="btn btn-primary btn-lg" onclick="downloadCertificate()">ä¸‹è¼‰ PNG</button>
                        <button class="btn btn-success btn-lg" onclick="printCertificate()">åˆ—å° / å„²å­˜ PDF</button>
                        <button class="cert-btn-linkedin" onclick="addToLinkedIn()">æ–°å¢è‡³ LinkedIn</button>
                    </div>
                    <div class="alert alert-info">
                        <span class="alert-icon">ğŸ’¡</span>
                        <div>
                            <strong>æ“ä½œæç¤º</strong>
                            <p style="margin: 5px 0 0;">ã€Œåˆ—å° / å„²å­˜ PDFã€æœƒé–‹å•Ÿç€è¦½å™¨åˆ—å°å°è©±æ¡†ï¼Œæ‚¨å¯é¸æ“‡ã€Œå¦å­˜ç‚º PDFã€ä¾†å„²å­˜ PDF æª”æ¡ˆã€‚å»ºè­°é¸æ“‡æ©«å‘ (Landscape) åˆ—å°ã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- Print Area (hidden on screen) -->
                <div id="cert-print-area" class="cert-print-only">
                    <div class="cert-print-border">
                        <div class="cert-print-org" id="print-org">è¡›ç”Ÿç¦åˆ©éƒ¨ç–¾ç—…ç®¡åˆ¶ç½²</div>
                        <div class="cert-print-title">çµ æ¥­ è­‰ æ›¸</div>
                        <div class="cert-print-divider"></div>
                        <p>èŒ²è­‰æ˜</p>
                        <div class="cert-print-name" id="print-name"></div>
                        <p>å·²å®Œæˆ</p>
                        <div class="cert-print-course">ã€ŒAI æ‡‰ç”¨åŸºç¤ç­ã€ç·šä¸Šè‡ªå­¸èª²ç¨‹</div>
                        <div class="cert-print-detail" id="print-detail"></div>
                        <div class="cert-print-detail" id="print-date"></div>
                        <div class="cert-print-id" id="print-cert-id"></div>
                        <div class="cert-print-footer">è¡›ç”Ÿç¦åˆ©éƒ¨ç–¾ç—…ç®¡åˆ¶ç½² AI æ‡‰ç”¨åŸºç¤ç­ç·šä¸Šè‡ªå­¸å¹³å°</div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-bottom">
                    <p>è¡›ç”Ÿç¦åˆ©éƒ¨ç–¾ç—…ç®¡åˆ¶ç½² AI æ‡‰ç”¨åŸºç¤ç­ç·šä¸Šè‡ªå­¸å¹³å°</p>
                </div>
            </div>
        </footer>
    </div>

    <script src="js/main.js"></script>
    <script>
        var certName = '';
        var certDate = '';
        var certId = '';
        var certScore = null;

        // Check eligibility on load
        (function() {
            var result = CDC_Learning.isCertificateEligible();
            var details = result.details;

            if (result.eligible) {
                document.getElementById('cert-eligible').style.display = 'block';
                var scoreDisplay = document.getElementById('cert-score-display');
                scoreDisplay.innerHTML =
                    '<span class="alert-icon">&#127891;</span>' +
                    '<div><strong>æ­å–œï¼æ‚¨å·²ç¬¦åˆé ˜å–è­‰æ›¸çš„è³‡æ ¼</strong>' +
                    '<p style="margin: 5px 0 0;">æ‰€æœ‰æ¨¡çµ„å·²å®Œæˆï¼Œçµæ¥­æ¸¬é©—æˆç¸¾ï¼š' +
                    details.examScore.correct + '/' + details.examScore.total +
                    'ï¼ˆ' + details.examScore.percentage + '%ï¼‰</p></div>';
            } else {
                document.getElementById('cert-not-eligible').style.display = 'block';
                var listEl = document.getElementById('cert-requirements-list');
                var html = '';

                var moduleNames = ['æ¨¡çµ„ 0ï¼šå­¸å‰æº–å‚™', 'æ¨¡çµ„ 1ï¼šèªè­˜ç”Ÿæˆå¼ AI', 'æ¨¡çµ„ 2ï¼šPrompt å››è¦ç´ ', 'æ¨¡çµ„ 3ï¼šæ–‡æ›¸è™•ç†æ‡‰ç”¨', 'æ¨¡çµ„ 4ï¼šè³‡æ–™æ•´ç†æ‡‰ç”¨', 'æ¨¡çµ„ 5ï¼šé€²éšæŠ€å·§'];
                details.modules.forEach(function(m, i) {
                    var cls = m.completed ? 'cert-req-done' : 'cert-req-pending';
                    var badge = m.completed
                        ? '<span class="badge badge-success">å·²å®Œæˆ</span>'
                        : '<span class="badge badge-warning">æœªå®Œæˆ</span>';
                    html += '<li class="' + cls + '"><span>' + moduleNames[i] + '</span>' + badge + '</li>';
                });

                var examCls = details.examPassed ? 'cert-req-done' : 'cert-req-pending';
                var examBadge = details.examPassed
                    ? '<span class="badge badge-success">' + details.examScore.correct + '/10ï¼ˆ' + details.examScore.percentage + '%ï¼‰</span>'
                    : '<span class="badge badge-warning">' + details.examScore.correct + '/10ï¼ˆéœ€ â‰¥ 80%ï¼‰</span>';
                html += '<li class="' + examCls + '"><span>çµæ¥­æ¸¬é©—æˆç¸¾ â‰¥ 80%</span>' + examBadge + '</li>';

                listEl.innerHTML = html;
            }
        })();

        function generateCertificate() {
            var nameInput = document.getElementById('cert-name-input');
            var errorEl = document.getElementById('cert-name-error');
            var name = nameInput.value.trim();

            if (!name) {
                errorEl.style.display = 'block';
                nameInput.focus();
                return;
            }
            errorEl.style.display = 'none';

            certName = name;
            var now = new Date();
            certDate = now.getFullYear() + '/' + String(now.getMonth() + 1).padStart(2, '0') + '/' + String(now.getDate()).padStart(2, '0');
            certScore = CDC_Learning.getFinalExamScore();
            var dateForId = now.getFullYear() + String(now.getMonth() + 1).padStart(2, '0') + String(now.getDate()).padStart(2, '0');
            certId = CDC_Learning.generateCertificateId(name, dateForId, certScore.percentage);

            drawCertificateCanvas();
            buildPrintCertificate();

            var previewSection = document.getElementById('cert-preview-section');
            previewSection.style.display = 'block';
            setTimeout(function() {
                previewSection.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function drawCertificateCanvas() {
            var canvas = document.getElementById('cert-canvas');
            var ctx = canvas.getContext('2d');
            var w = 1200, h = 850;

            // Background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, w, h);

            // Outer border
            ctx.strokeStyle = '#1a5f7a';
            ctx.lineWidth = 4;
            ctx.strokeRect(20, 20, w - 40, h - 40);

            // Inner border
            ctx.strokeStyle = '#1a5f7a';
            ctx.lineWidth = 1.5;
            ctx.strokeRect(32, 32, w - 64, h - 64);

            // Corner decorations (L-shaped)
            var cornerLen = 40;
            ctx.strokeStyle = '#159895';
            ctx.lineWidth = 3;
            // Top-left
            ctx.beginPath(); ctx.moveTo(20, 20 + cornerLen); ctx.lineTo(20, 20); ctx.lineTo(20 + cornerLen, 20); ctx.stroke();
            // Top-right
            ctx.beginPath(); ctx.moveTo(w - 20 - cornerLen, 20); ctx.lineTo(w - 20, 20); ctx.lineTo(w - 20, 20 + cornerLen); ctx.stroke();
            // Bottom-left
            ctx.beginPath(); ctx.moveTo(20, h - 20 - cornerLen); ctx.lineTo(20, h - 20); ctx.lineTo(20 + cornerLen, h - 20); ctx.stroke();
            // Bottom-right
            ctx.beginPath(); ctx.moveTo(w - 20 - cornerLen, h - 20); ctx.lineTo(w - 20, h - 20); ctx.lineTo(w - 20, h - 20 - cornerLen); ctx.stroke();

            // Top decorative line
            var lineY = 70;
            ctx.strokeStyle = '#1a5f7a';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(100, lineY); ctx.lineTo(w - 100, lineY); ctx.stroke();
            ctx.strokeStyle = '#57c5b6';
            ctx.lineWidth = 1;
            ctx.beginPath(); ctx.moveTo(100, lineY + 5); ctx.lineTo(w - 100, lineY + 5); ctx.stroke();

            // Organization name
            ctx.fillStyle = '#888888';
            ctx.font = '18px "Microsoft JhengHei", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('è¡›ç”Ÿç¦åˆ©éƒ¨ç–¾ç—…ç®¡åˆ¶ç½²', w / 2, 115);

            // Title
            ctx.fillStyle = '#1a5f7a';
            ctx.font = 'bold 52px "Microsoft JhengHei", sans-serif';
            ctx.fillText('çµ æ¥­ è­‰ æ›¸', w / 2, 185);

            // Divider under title
            ctx.strokeStyle = '#57c5b6';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(w / 2 - 120, 205); ctx.lineTo(w / 2 + 120, 205); ctx.stroke();

            // "èŒ²è­‰æ˜"
            ctx.fillStyle = '#333333';
            ctx.font = '22px "Microsoft JhengHei", sans-serif';
            ctx.fillText('èŒ²è­‰æ˜', w / 2, 260);

            // Student name
            ctx.fillStyle = '#1a5f7a';
            ctx.font = 'bold 42px "Microsoft JhengHei", sans-serif';
            var nameWidth = ctx.measureText(certName).width;
            ctx.fillText(certName, w / 2, 320);

            // Name underline
            ctx.strokeStyle = '#159895';
            ctx.lineWidth = 2;
            var underlineHalf = Math.max(nameWidth / 2 + 20, 80);
            ctx.beginPath(); ctx.moveTo(w / 2 - underlineHalf, 330); ctx.lineTo(w / 2 + underlineHalf, 330); ctx.stroke();

            // "å·²å®Œæˆ"
            ctx.fillStyle = '#333333';
            ctx.font = '22px "Microsoft JhengHei", sans-serif';
            ctx.fillText('å·²å®Œæˆ', w / 2, 380);

            // Course name
            ctx.fillStyle = '#333333';
            ctx.font = 'bold 30px "Microsoft JhengHei", sans-serif';
            ctx.fillText('ã€ŒAI æ‡‰ç”¨åŸºç¤ç­ã€ç·šä¸Šè‡ªå­¸èª²ç¨‹', w / 2, 430);

            // Module count + exam score
            ctx.fillStyle = '#555555';
            ctx.font = '20px "Microsoft JhengHei", sans-serif';
            ctx.fillText('å®Œæˆ 6 å€‹å­¸ç¿’æ¨¡çµ„ï¼Œçµæ¥­æ¸¬é©—æˆç¸¾ï¼š' + certScore.correct + '/' + certScore.total + 'ï¼ˆ' + certScore.percentage + '%ï¼‰', w / 2, 480);

            // Completion date
            ctx.fillText('å®Œæˆæ—¥æœŸï¼š' + certDate, w / 2, 520);

            // Certificate ID
            ctx.fillStyle = '#999999';
            ctx.font = '16px "Consolas", "Courier New", monospace';
            ctx.fillText('Certificate ID: ' + certId, w / 2, 570);

            // Bottom decorative line
            var botY = 750;
            ctx.strokeStyle = '#1a5f7a';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(100, botY); ctx.lineTo(w - 100, botY); ctx.stroke();
            ctx.strokeStyle = '#57c5b6';
            ctx.lineWidth = 1;
            ctx.beginPath(); ctx.moveTo(100, botY - 5); ctx.lineTo(w - 100, botY - 5); ctx.stroke();

            // Platform footer text
            ctx.fillStyle = '#aaaaaa';
            ctx.font = '14px "Microsoft JhengHei", sans-serif';
            ctx.fillText('è¡›ç”Ÿç¦åˆ©éƒ¨ç–¾ç—…ç®¡åˆ¶ç½² AI æ‡‰ç”¨åŸºç¤ç­ç·šä¸Šè‡ªå­¸å¹³å°', w / 2, 790);
        }

        function buildPrintCertificate() {
            document.getElementById('print-name').textContent = certName;
            document.getElementById('print-detail').textContent = 'å®Œæˆ 6 å€‹å­¸ç¿’æ¨¡çµ„ï¼Œçµæ¥­æ¸¬é©—æˆç¸¾ï¼š' + certScore.correct + '/' + certScore.total + 'ï¼ˆ' + certScore.percentage + '%ï¼‰';
            document.getElementById('print-date').textContent = 'å®Œæˆæ—¥æœŸï¼š' + certDate;
            document.getElementById('print-cert-id').textContent = 'Certificate ID: ' + certId;
        }

        function downloadCertificate() {
            var canvas = document.getElementById('cert-canvas');
            var link = document.createElement('a');
            link.download = 'AIæ‡‰ç”¨åŸºç¤ç­çµæ¥­è­‰æ›¸_' + certName + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function printCertificate() {
            window.print();
        }

        function addToLinkedIn() {
            var now = new Date();
            var params = new URLSearchParams({
                startTask: 'CERTIFICATION_NAME',
                name: 'AI æ‡‰ç”¨åŸºç¤ç­çµæ¥­è­‰æ›¸',
                organizationName: 'è¡›ç”Ÿç¦åˆ©éƒ¨ç–¾ç—…ç®¡åˆ¶ç½²',
                issueYear: String(now.getFullYear()),
                issueMonth: String(now.getMonth() + 1),
                certId: certId
            });
            window.open('https://www.linkedin.com/profile/add?' + params.toString(), '_blank', 'noopener');
        }
    </script>
</body>
</html>
